
<link rel="stylesheet" href="/css/profile.css">
<style>
    .container{
        margin-top: 2em; 
    }
    #leaveRoom{
    
        /* margin: 0 auto; */
        position: fixed;
        bottom: 10px; 
        left: 10%;
        padding: 1em;  
    }
    #msg{
        margin-top: 2em; 
    }
    .chatbox{
        margin-top: 5em;
        width: 90%; 
        margin: 2em auto;  
        /* padding: 2em;  */
        background-color: black;
        color: white; 
        border-bottom: 4px;
    }
    .self-container{
        display:flex; 
        flex-direction: column;
        align-items: flex-end;
    }
    .self, .other{
        border-radius: 4px;
        font-size: 1.5em; 
        padding: 0; 
        margin: 0; 
        padding:  0.4em 1em; 
    }
    small{
        padding:  0.4em 1em; 
        color: rgba(204, 203, 203, 0.768); 
        font-size: 0.7em; 
        background-color: white;
        color: black; 
        border-radius: 4px;
    }

    .self{
        text-align: right;

    }
    #sendMessage{
        width: 90%; 
        margin: 0 auto;  
        padding: 0; 
    }
</style>
<div class="container">
    <form action="/" class="form" id="connectRoom">
    <label for="user-to-connect" class="form-label">Enter Room Name</label>
    <input type="text" name='user-to-connect' id="search">
    <button type="submit">Connect</button>
    </form>
</div>

<div class="chatbox d-none">
    
</div>
<form action="/" class="form d-none" id="sendMessage">
    <input type="text" name='message' id="msg" placeholder="Enter Message.">
    <button type="submit">Send</button>
</form>

    <button class="btn d-none" id="leaveRoom">Leave Room</button>

<script src="/js/chat_engine.js"></script>
<script>
    var c = new ChatEngine('<%= user.email %>'); 
    if(!window.localStorage.getItem('room')){
        $('#connectRoom').on('submit',function(e){
            console.log('hello'); 
            e.preventDefault(); 
            c.joinRoom($('#search').val());
            hideAllOther();   
        }); 
    }else{
        c.joinRoom(window.localStorage.getItem('room'));
        hideAllOther(); 
    }
    $('#sendMessage').on('submit', (e)=>{
        e.preventDefault(); 
        let msg = $('#msg').val(); 
        let d = {
            message: msg,  
            roomName: window.localStorage.getItem('room')
        }; 
        c.sendMessage(d); 
        $('#msg').val(''); 
    }); 
    function hideAllOther(){
        $('.container').addClass('d-none'); 
        $('#leaveRoom').removeClass('d-none');
        $('#sendMessage').removeClass('d-none'); 
        $('.chatbox').removeClass('d-none'); 
        $('#leaveRoom').on('click', ()=>{
            window.localStorage.removeItem('room');
            window.location.reload();  
        }); 
    }
    
    // $('form[action="/user/connect"').on('submit', function(event){
    //     event.preventDefault(); 
    //     console.log($(this).children('input[name]').val()); 
    //     c.joinRoom($(this).children('input[name]').val()); 
    // })
</script>